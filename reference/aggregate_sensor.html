<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Aggregate raw sensor data to a chosen level — aggregate_sensor • tc.sensors</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/simplex/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Aggregate raw sensor data to a chosen level — aggregate_sensor"><meta property="og:description" content="Aggregate raw sensor data to a chosen level"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">tc.sensors</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.2.0.9002</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/calculate_speed_delay.html">Calculate speed and delay</a>
    </li>
    <li>
      <a href="../articles/pulling_sensors_in_parallel.html">Pull multiple sensors using parallel processing</a>
    </li>
    <li>
      <a href="../articles/tc.sensors.html">tc.sensors</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/Metropolitan-Council/tc.sensors/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Aggregate raw sensor data to a chosen level</h1>
    <small class="dont-index">Source: <a href="https://github.com/Metropolitan-Council/tc.sensors/blob/HEAD/R/aggregate_sensor.R" class="external-link"><code>R/aggregate_sensor.R</code></a></small>
    <div class="hidden name"><code>aggregate_sensor.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Aggregate raw sensor data to a chosen level</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="fu">aggregate_sensor</span><span class="op">(</span>
  <span class="va">sensor_data</span>,
  <span class="va">config</span>,
  <span class="va">interval_length</span>,
  replace_impossible <span class="op">=</span> <span class="cn">TRUE</span>,
  interpolate_missing <span class="op">=</span> <span class="cn">FALSE</span>,
  occupancy_pct_threshold <span class="op">=</span> <span class="fl">0.002</span>
<span class="op">)</span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>sensor_data</dt>
<dd><p>data frame for single sensor returned from <code><a href="pull_sensor.html">pull_sensor()</a></code></p></dd>
<dt>config</dt>
<dd><p>data.table, a configuration file for the given sensor</p></dd>
<dt>interval_length</dt>
<dd><p>numeric, the interval length in hours.
<code>NA</code> indicates no aggregation (30 second data)
<code>0.25</code> indicates 15 minutes.
Default is <code>1</code>.</p></dd>
<dt>replace_impossible</dt>
<dd><p>logical, whether to replace impossible values with <code>NA</code>.
Default is <code>TRUE</code> and <em>highly</em> recommended.</p></dd>
<dt>interpolate_missing</dt>
<dd><p>logical, whether to interpolate missing volume and occupancy
values at the raw data level. Only applies if <code>replace_impossible</code> is <code>TRUE</code>. Note
that this option increases the function runtime.</p></dd>
<dt>occupancy_pct_threshold</dt>
<dd><p>numeric, the lowest possible occupancy percentage
to use when calculating speed. Default is <code>0.0020</code> or 0.2%. Increasing the threshold
results in more stable speed values, while lowering it may increase speed variability.
A higher occupancy threshold is recommended for shorter interval lengths</p></dd>
</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>a data.table with values for volume, occupancy, and speed</p><ul><li><p><code>date</code> IDate, the given date</p></li>
<li><p><code>interval_bin</code> numeric, the observations interval bin</p></li>
<li><p><code>{measure}.pct_null</code> numeric, the percentage of observations with null
values for the given measure</p></li>
<li><p><code>{measure}.sum</code> numeric, the measure's total over the given interval</p></li>
<li><p><code>{measure}.mean</code> numeric, the measure's mean over the given interval</p></li>
<li><p><code>speed</code> numeric, the mean traffic speed over the given interval</p></li>
</ul></div>
    <div id="details">
    <h2>Details</h2>
    
<div class="section">
<h3 id="calculating-speed">Calculating speed<a class="anchor" aria-label="anchor" href="#calculating-speed"></a></h3>
<div class="sourceCode"><pre><code>There are 60 scans per second, which means there are 60*60 = 1,800 scans per
30-second interval. The occupancy value in the 30-second interval data
represents the number of scans that were occupied of the 1,800 scans in that
interval.

With 60 scans per second, 60 seconds per minute there are 3,600 scans per minute.
With 3,600 scans per minute, 60 minutes per hour there are 216,000 scans per hour.
To find the number of scans in 15 minutes, we can multiply 0.25 * 216000 = 54,000 scans.
</code></pre></div>

</div>

<div class="section">
<h3 id="impossible-values">Impossible values<a class="anchor" aria-label="anchor" href="#impossible-values"></a></h3>
<div class="sourceCode"><pre><code>Any observation with a volume that exceeds 20 vehicles or an occupancy that exceeds 1,800 scans
will be replaced with `NA`. It is impossible for more than twenty vehicles to pass over a sensor
in only 30 seconds, and the maximum number of scans in 30 seconds is 1,800 (60 scans/second * 30 seconds).

### Interpolating missing values

  `interpolate_missing` indicates whether to interpolate missing volume and occupancy values
  at the raw data level. The interpolated value for a given observation is the mean of
  the two observations on either side of the observation. This method preserves the variable's
  overall distribution.
</code></pre></div>

</div>

    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">tc.sensors</span><span class="op">)</span></span>
<span class="r-in"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span class="r-in"><span class="va">config</span> <span class="op">&lt;-</span> <span class="fu"><a href="pull_configuration.html">pull_configuration</a></span><span class="op">(</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="va">config_sample</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">config</span>, <span class="va">config</span><span class="op">$</span><span class="va">detector_abandoned</span> <span class="op">==</span> <span class="st">"f"</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span>
<span class="r-in">  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/sample_n.html" class="external-link">sample_n</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span class="r-in"><span class="va">yesterday</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.Date</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-</span> <span class="fl">365</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="va">sensor_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="pull_sensor.html">pull_sensor</a></span><span class="op">(</span></span>
<span class="r-in">  sensor <span class="op">=</span> <span class="va">config_sample</span><span class="op">$</span><span class="va">detector_name</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,</span>
<span class="r-in">  pull_date <span class="op">=</span> <span class="va">yesterday</span></span>
<span class="r-in"><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="fu">aggregate_sensor</span><span class="op">(</span><span class="va">sensor_results</span>,</span>
<span class="r-in">  interval_length <span class="op">=</span> <span class="fl">1</span>,</span>
<span class="r-in">  config <span class="op">=</span> <span class="va">config_sample</span></span>
<span class="r-in"><span class="op">)</span></span>
<span class="r-in"><span class="op">}</span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Liz Roten, Nicole Sullivan.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.1.</p>
</div>

      </footer></div>

  


  

  </body></html>

